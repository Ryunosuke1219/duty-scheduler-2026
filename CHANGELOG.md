# 変更履歴

## 2026-01-08: OC制約とG0負荷バランスの改善

### 発見したバグと修正

#### 1. OC整合性バグ
- **問題**: schedule.xlsx と annotated CSV で OC 数が不一致（田邉: xlsx=2, CSV=0）
- **原因**: 日直シフトに OC 制約がなく、solver が複数医師を同シフトに割り当て、結果収集時に上書き
- **修正**: 日直シフトへの OC 割り当てを禁止

#### 2. 勤務間隔問題
- **問題**: 田邉が 2/1 OC → 2/2 当直 → 2/3 OC と3日連続
- **原因**: 間隔チェックが当直のみ対象で OC を考慮していなかった
- **修正**: G0 は当直・OC 両方を含めた間隔チェックに拡張

#### 3. 同日重複問題
- **問題**: 野田が同日に日直と当直 OC を担当
- **修正**: 日直担当者は同日の当直 OC に入れない制約を追加

#### 4. G0 負荷不均衡
- **問題**: 渡邉=1, 田邉/神山=4 とミスマッチ
- **修正**: G0 最低負荷制約 (Total >= 2) と総負荷バランスのソフト制約を追加

### 最終的な制約設計

| 種類 | 制約 |
|------|------|
| ハード | 週1回制限、日祝日直月1回、当直上限2回、G0最低負荷2回 |
| ハード | 日直OC禁止、同日日直/OC重複禁止 |
| ソフト | 平日1回+土日祝1回、OC 2回、G0総負荷3-4回、間隔4日以上 |

### コミット
- `7a230fb` - OC制約とG0負荷バランスの改善
